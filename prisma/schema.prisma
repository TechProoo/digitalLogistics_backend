generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

enum ShipmentStatus {
  PENDING
  QUOTED
  ACCEPTED
  PICKED_UP
  IN_TRANSIT
  DELIVERED
  CANCELLED
}

enum ServiceType {
  ROAD
  AIR
  SEA
  DOOR_TO_DOOR
}

enum VehicleType {
  VAN
  BIKE
}

enum DriverApplicationStatus {
  PENDING
  NEEDS_INFO
  APPROVED
  REJECTED
}

enum DriverStatus {
  AVAILABLE
  BUSY
  OFFLINE
  SUSPENDED
}

model Customer {
  id        String   @id @default(uuid())
  name      String?
  email     String   @unique
  phone     String?
  passwordHash String? @db.VarChar(60)
  resetPasswordTokenHash String? @db.VarChar(64)
  resetPasswordTokenExpires DateTime?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  shipments Shipment[]

  @@index([name])
  @@index([resetPasswordTokenHash])
}

model Shipment {
  id          String         @id @default(uuid())
  trackingId  String         @unique
  customerId  String
  customer    Customer       @relation(fields: [customerId], references: [id], onDelete: Restrict)
  serviceType ServiceType
  status      ShipmentStatus @default(PENDING)

  driverId String?
  driver   Driver? @relation(fields: [driverId], references: [id], onDelete: SetNull)

  pickupLocation      String
  destinationLocation String

  packageType String
  weight      String
  dimensions  String
  phone       String
  receiverPhone String?

  // Declared item value in Nigerian Naira (whole number)
  declaredValueNgn Int?

  // Amount in Nigerian Naira (whole number)
  amount      Int            @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  statusHistory ShipmentStatusHistory[]
  checkpoints   ShipmentCheckpoint[]
  notes         ShipmentNote[]

  @@index([customerId])
  @@index([status])
  @@index([driverId])
  @@index([createdAt])
}

model ShipmentStatusHistory {
  id         String         @id @default(uuid())
  shipmentId String
  shipment   Shipment       @relation(fields: [shipmentId], references: [id], onDelete: Cascade)
  status     ShipmentStatus
  timestamp  DateTime       @default(now())
  adminName  String?
  note       String?

  @@index([shipmentId])
  @@index([shipmentId, timestamp])
}

model ShipmentCheckpoint {
  id          String   @id @default(uuid())
  shipmentId  String
  shipment    Shipment @relation(fields: [shipmentId], references: [id], onDelete: Cascade)
  location    String
  description String
  timestamp   DateTime @default(now())
  adminName   String?

  @@index([shipmentId])
  @@index([shipmentId, timestamp])
}

model ShipmentNote {
  id         String   @id @default(uuid())
  shipmentId String
  shipment   Shipment @relation(fields: [shipmentId], references: [id], onDelete: Cascade)
  text       String
  timestamp  DateTime @default(now())
  adminName  String?

  @@index([shipmentId])
  @@index([shipmentId, timestamp])
}

model Driver {
  id String @id @default(uuid())

  vehicleType VehicleType
  plateNumber String

  applicationStatus DriverApplicationStatus @default(PENDING)
  status DriverStatus @default(OFFLINE)

  proofOfOwnershipPath String
  vehicleLicensePath   String
  hackneyPermitPath    String
  vehicleInsurancePath String
  vehicleVideoPath     String

  driversLicensePath String
  meansOfIdPath      String

  driverName          String
  driverAddress       String
  driverFacePhotoPath String
  driverFullBodyPhotoPath String

  guarantorName        String
  guarantorAddress     String
  guarantorPhone       String
  guarantorNin         String
  guarantorMeansOfIdPath String

  shipments Shipment[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([vehicleType])
  @@index([applicationStatus])
  @@index([status])
  @@index([createdAt])
}
